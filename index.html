<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pomodoro Dashboard</title>
  <meta http-equiv="refresh" content="15" />
  <style>
    body {
      font-family: sans-serif;
      background-color: #1e1e1e;
      color: white;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    #progress-bar {
      width: 100%;
      background-color: #333;
      height: 30px;
      border-radius: 5px;
      overflow: hidden;
      margin-top: 10px;
    }
    #progress {
      height: 100%;
      width: 0%;
      background-color: #00ffcc;
      transition: width 0.5s ease;
    }
    #session {
      font-weight: bold;
      font-size: 1.5rem;
    }
  </style>
</head>
<body>
  <h1>ðŸ§  Pomodoro Dashboard</h1>
  <p>Session: <span id="session">--</span></p>
  <p>Time Left: <span id="time-left">--</span></p>
  <div id="progress-bar">
    <div id="progress"></div>
  </div>

  <script>
    async function loadStatus() {
      try {
	     const response = await fetch('./status.json');
        //const response = await fetch('status.json?' + Date.now());
        const data = await response.json();

        const session = data.session;
        const now = Math.floor(Date.now() / 1000);

        if (session === 'idle' || !data.start_time || !data.end_time) {
          document.getElementById('session').textContent = 'Idle / Not Working';
          document.getElementById('time-left').textContent = '--';
          document.getElementById('progress').style.width = '0%';
          return;
        }

        const start = data.start_time;
        const end = data.end_time;
        const total = end - start;
        const remaining = Math.max(0, end - now);
        const elapsed = Math.min(total, now - start);
        const percent = (elapsed / total) * 100;

        document.getElementById('session').textContent = session.charAt(0).toUpperCase() + session.slice(1);
        document.getElementById('time-left').textContent = Math.floor(remaining / 60) + 'm ' + (remaining % 60) + 's';
        document.getElementById('progress').style.width = percent + '%';
      } catch (err) {
        document.getElementById('session').textContent = 'Error loading status';
        document.getElementById('time-left').textContent = '--';
        document.getElementById('progress').style.width = '0%';
      }
    }

    loadStatus();
    setInterval(loadStatus, 10000);
  </script>
</body>
</html>
